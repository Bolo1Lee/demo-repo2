{% extends "base.html" %}

{% block title %}Subir Documento{% endblock %}

{% block page_title %}📄 Subir Documento{% endblock %}

{% block boton_derecha %}
<a href="{% url 'home' %}" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded flex items-center gap-2 w-fit mt-2">
  🏠 Volver al Inicio
</a>
{% endblock %}

{% block content %}

<h1 class="text-2xl font-bold text-gray-900 dark:text-white text-center mb-6">
  📤 Subir Documento para Generar Preguntas
</h1>

{% if error %}
  <p class="text-red-500 text-center mb-6 font-semibold">{{ error }}</p>
{% endif %}

<form method="POST" enctype="multipart/form-data" class="max-w-3xl mx-auto bg-white dark:bg-gray-800 rounded-lg p-6 shadow space-y-6">
  {% csrf_token %}

  <div>
    <label for="archivo" class="block font-semibold mb-1">Selecciona un archivo (.pdf, .pptx o .txt):</label>
    <input type="file" name="archivo" accept=".pdf,.ppt,.pptx,.txt" required
      class="w-full p-3 rounded bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white border border-gray-300 dark:border-gray-600" />
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div>
      <label for="tema_existente" class="block font-semibold mb-1">Selecciona un tema existente:</label>
      <select name="tema_existente"
        class="w-full p-3 rounded bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white border border-gray-300 dark:border-gray-600">
        <option value="">-- Selecciona un tema --</option>
        {% for tema in temas %}
        <option value="{{ tema.id }}">{{ tema.nombre }}</option>
        {% endfor %}
      </select>
    </div>

    <div>
      <label for="tema_nuevo" class="block font-semibold mb-1">O crea un tema nuevo:</label>
      <input type="text" name="tema_nuevo" placeholder="Ej: Nefrología"
        class="w-full p-3 rounded bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white border border-gray-300 dark:border-gray-600" />
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div>
      <label for="cantidad" class="block font-semibold mb-1">Cantidad de preguntas (máx 20):</label>
      <input type="number" name="cantidad" min="1" max="20" value="5" required
        class="w-full p-3 rounded bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white border border-gray-300 dark:border-gray-600" />
    </div>

    <div>
      <label for="tipo" class="block font-semibold mb-1">Tipo de pregunta:</label>
      <select name="tipo"
        class="w-full p-3 rounded bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white border border-gray-300 dark:border-gray-600">
        <option value="clinica">Clínica</option>
        <option value="conceptual">Conceptual</option>
      </select>
    </div>
  </div>

  <button type="submit"
    class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded shadow w-full">
    🚀 Subir y Generar
  </button>

  <div id="loader" class="loader mx-auto mt-6 hidden border-4 border-gray-300 border-t-blue-500 rounded-full w-12 h-12 animate-spin"></div>
</form>

<script>
  const form = document.querySelector("form");
  const loader = document.getElementById("loader");
  form?.addEventListener("submit", () => {
    loader.classList.remove("hidden");
  });
</script>

{% if preguntas %}
  <div class="max-w-3xl mx-auto mt-10 bg-green-100 dark:bg-green-900 text-green-900 dark:text-green-100 p-6 rounded-lg shadow space-y-6">
    <h3 class="text-lg font-semibold">✅ Se generaron {{ preguntas|length }} preguntas:</h3>

    {% for pregunta in preguntas %}
    <div class="space-y-1 border-b border-gray-300 dark:border-gray-700 pb-4 mb-4">
      <p><strong>{{ pregunta.pregunta }}</strong></p>
      <ul class="list-disc pl-5">
        <li><strong>A:</strong> {{ pregunta.alternativa_a }}</li>
        <li><strong>B:</strong> {{ pregunta.alternativa_b }}</li>
        <li><strong>C:</strong> {{ pregunta.alternativa_c }}</li>
        <li><strong>D:</strong> {{ pregunta.alternativa_d }}</li>
      </ul>
      <p><strong>Respuesta correcta:</strong> {{ pregunta.respuesta_correcta }}</p>
      <p><strong>Explicación:</strong> {{ pregunta.explicacion }}</p>
    </div>
    {% endfor %}
  </div>
{% endif %}

<p class="text-xs text-gray-400 mt-6 text-center">
  Modelo usado: {{ modelo_usado }}
</p>

{% endblock %}
